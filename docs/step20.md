# 성능 분석 및 가상 장애 대응 보고서

## 목차

1. 성능 지표 분석
2. 병목 지점 탐색 및 개선 사항
3. 장애 대응 계획

---

## 1. 성능 지표 분석

이번 부하 테스트를 통해 좌석 예약과 예약 가능 좌석 조회 기능의 다양한 성능 지표를 획득하였다. 두 테스트 모두 안정성 측면에서는 오류율 0%로 매우 양호한 결과를 보였으나, 성능 측면에서 개선이 필요한 부분이 다수 확인되었다.

### 1.1 좌석 예약 API

- **평균 응답 시간**이 2.69초로 다소 긴 편이며, **최대 응답 시간**이 5.63초로 일부 요청에서 성능 저하가 발생하였다.
- **처리량**은 초당 55.18개의 요청을 처리하여 안정성은 보장되었으나, 보다 효율적인 처리량을 확보할 필요가 있다.
- **병목 지점**: 응답 시간이 긴 주요 원인은 데이터베이스 접근 시의 지연이나, 비효율적인 쿼리 처리에서 비롯된 것으로 추정된다.

### 1.2 예약 가능 좌석 조회 API

- **평균 응답 시간**은 523.89ms로 양호한 수준이었으나, **최대 응답 시간**이 3.18초로 일부 사용자에게는 불편함을 초래할 수 있는 수준이다.
- **처리량**은 초당 229.42개의 요청을 처리하여 양호한 처리량을 보인다.
- **병목 지점**: 예약 가능 좌석 조회 시 다수의 데이터가 조회되는 과정에서 캐싱이 사용되지 않아 지연이 발생할 가능성이 있다.

## 2. 병목 지점 탐색 및 개선 사항

### 2.1 좌석 예약 API 개선 사항

- **데이터베이스 최적화**: 좌석 예약 시 데이터베이스 접근 횟수를 줄이기 위해 쿼리 최적화 및 인덱스를 추가해야 한다.
- **캐싱 도입**: 예약 가능한 좌석 정보를 캐싱하여 반복되는 데이터 조회를 줄임으로써 응답 시간을 개선할 수 있다.
- **비동기 처리**: 일부 프로세스를 비동기적으로 처리하여 주요 흐름의 성능을 향상시킬 필요가 있다.

### 2.2 예약 가능 좌석 조회 API 개선 사항

- **쿼리 최적화**: 조회 시 불필요한 컬럼이나 데이터를 조회하지 않도록 쿼리를 최적화함으로써 성능을 개선할 수 있다.
- **캐싱 전략**: 좌석 조회와 같이 자주 요청되는 데이터를 캐싱하여 데이터베이스 부담을 줄이고, 빠른 응답을 제공할 수 있다.

## 3. 장애 대응 계획

### 3.1 가상 장애 상황 및 대응 방안

가상 장애 상황을 몇 가지 시나리오로 설정하고, 각 상황에 대해 주니어 개발자가 이해하고 적용할 수 있는 수준으로 대응 방안을 제시한다.

#### 3.1.1 가상 장애 상황 1: 서버 과부하로 인한 성능 저하

- **상황 설명**: 대규모 이벤트나 프로모션으로 인해 대량의 사용자 요청이 한꺼번에 몰려 서버에 과부하가 발생하고, 응답 시간이 급격히 늘어나거나 서버가 다운될 수 있다.
- **대응 방안**:
  - **자동 스케일링 도입**: 클라우드 서비스(AWS, Azure 등)에서 제공하는 자동 스케일링 기능을 설정하여 트래픽 증가에 따라 서버 인스턴스를 자동으로 늘린다. 이를 통해 요청이 몰리는 상황에서도 안정성을 유지할 수 있다.
  - **로드 밸런서 설정**: 로드 밸런서를 사용하여 여러 서버에 요청을 분산시켜서 특정 서버에 과부하가 걸리지 않도록 한다. 예를 들어, AWS의 ELB를 사용해 볼 수 있다.
  - **간단한 트래픽 제한**: 특정 사용자가 너무 많은 요청을 보내는 경우, API 게이트웨이에서 Rate Limiting을 설정하여 요청 수를 제한한다. 이를 통해 서버의 부하를 줄일 수 있다.

#### 3.1.2 가상 장애 상황 2: 데이터베이스 병목 발생

- **상황 설명**: 사용자 요청이 급증하면서 데이터베이스에 집중적인 읽기 및 쓰기 작업이 발생하여, 데이터베이스 병목 현상이 나타난다.
- **대응 방안**:
  - **데이터베이스 리드 레플리카 추가**: 데이터베이스에 읽기 요청이 많을 때는 읽기 전용 데이터베이스(리드 레플리카)를 추가하여 메인 데이터베이스의 부하를 줄인다. 읽기 요청을 여러 서버에 분산시켜 성능을 개선할 수 있다.
  - **쿼리 최적화**: 실행 속도가 느린 쿼리를 찾아 쿼리 구조를 개선하거나 필요한 인덱스를 추가한다. 예를 들어, `EXPLAIN` 명령어를 사용해 쿼리 성능을 분석해 본다.
  - **데이터베이스 샤딩 고려**: 데이터가 너무 많아 한 데이터베이스에서 처리하기 어려운 경우, 데이터를 여러 데이터베이스로 나누어 저장하는 샤딩을 고려한다. 다만, 이는 구조가 복잡해질 수 있어 주니어 개발자는 신중하게 접근해야 한다.

#### 3.1.3 가상 장애 상황 3: 캐시 서버 장애

- **상황 설명**: 캐시 서버(Redis, Memcached 등)에 장애가 발생하여 모든 요청이 데이터베이스로 직접 전달되고, 이에 따라 데이터베이스 부하가 급증한다.
- **대응 방안**:
  - **캐시 서버 이중화 구성**: 캐시 서버를 하나 더 추가하여, 하나의 캐시 서버에 문제가 발생해도 다른 캐시 서버가 요청을 처리할 수 있도록 한다. 이를 통해 장애 시에도 캐시 기능을 유지할 수 있다.
  - **Fallback 전략 적용**: 캐시 서버 장애 시에도 데이터베이스가 갑자기 과부하 되지 않도록 일부 덜 중요한 요청은 처리하지 않고, 중요한 요청만 데이터베이스에서 처리하도록 Fallback 전략을 적용한다.
  - **캐시 데이터 재구성**: 캐시 서버가 복구된 후 빠르게 주요 데이터를 다시 캐시에 로드하여 정상적인 상태로 돌아갈 수 있도록 한다.

#### 3.1.4 가상 장애 상황 4: 네트워크 단절로 인한 서비스 중단

- **상황 설명**: 네트워크 장애로 인해 일부 서버와 데이터베이스 간의 연결이 끊어져 서비스가 중단될 위험이 있다.
- **대응 방안**:
  - **로컬 데이터베이스 사용**: 일시적인 네트워크 장애가 발생했을 때 중요한 데이터를 처리하기 위해 로컬에 임시 데이터베이스를 사용하여 연결 복구 후 메인 데이터베이스로 동기화하는 방법을 고려한다.
  - **서킷 브레이커 패턴 도입**: 네트워크 장애가 반복되면 서킷 브레이커 패턴을 사용하여 연쇄적인 장애가 발생하지 않도록 요청을 차단하고 빠르게 복구할 수 있도록 한다.
  - **모니터링 및 경고 시스템**: 네트워크 상태를 지속적으로 모니터링하고, 문제가 발생하면 담당자에게 즉시 알림을 보내 빠르게 대응할 수 있도록 한다.

#### 3.1.5 가상 장애 상황 5: 특정 서비스의 과부하로 인한 전체 시스템 지연

- **상황 설명**: 특정 서비스(예: 결제 서비스)가 과부하로 인해 지연되면서 전체 시스템의 성능이 저하되고 다른 서비스들까지 영향을 받는다.
- **대응 방안**:
  - **서킷 브레이커 및 폴백 적용**: 특정 서비스에서 응답 시간이 지나치게 길어지면 서킷 브레이커를 적용해 해당 서비스로의 요청을 중단하고, 사용자가 적절한 오류 메시지를 받도록 한다.
  - **서비스 간 독립성 강화**: 문제가 발생한 서비스가 다른 서비스에 영향을 주지 않도록, 서비스 간의 결합도를 낮추고 독립적으로 확장 가능한 구조로 만든다.
  - **비동기 큐 사용**: 과부하가 발생하는 서비스에 대해 비동기 메시징 시스템(예: RabbitMQ, Kafka)을 도입하여 요청을 큐에 넣고 차례로 처리할 수 있도록 한다. 이를 통해 즉시 응답을 줄 수 있으며 시스템 과부하를 줄일 수 있다.

### 3.2 예방적 조치

- **지속적인 모니터링**: 클라우드 모니터링 도구(예: AWS CloudWatch)를 사용하여 서버와 데이터베이스의 상태를 지속적으로 확인하고, 문제가 발생하기 전에 알림을 받을 수 있도록 설정한다.
- **정기적인 부하 테스트**: JMeter나 K6 같은 도구를 사용해 주기적으로 부하 테스트를 수행하여 시스템이 어떤 한계점을 가지고 있는지 파악하고 개선한다. 이를 통해 예상하지 못한 상황에서의 장애를 예방할 수 있다.
- **장애 시나리오별 리허설**: 예상되는 장애 상황에 대한 리허설을 통해 실제 장애 발생 시 대응 속도와 효율성을 높인다. 예를 들어, 특정 서버가 다운되었을 때 어떻게 서비스가 유지될 수 있을지 연습해 본다.
- **데이터 백업 및 복구 계획 수립**: 주기적인 데이터 백업을 통해 데이터 손실 위험을 최소화하고, 필요할 때 빠르게 복구할 수 있는 절차를 마련한다. 정기적으로 백업 데이터를 사용해 복구 테스트를 해본다.

이번 보고서는 부하 테스트를 통해 확인된 성능 지표를 분석하고 시스템 내의 병목 지점을 개선하기 위한 방안을 제시하였다. 이를 통해 보다 안정적이고 빠른 예매 서비스를 제공하는 것을 목표로 한다.
